// For format details, see https://aka.ms/devcontainer.json. For config options, see the
// README at: https://github.com/devcontainers/templates/tree/main/src/rust
{
	"name": "Rust",
	"image": "mcr.microsoft.com/devcontainers/base:noble",

	// Features to add to the dev container. More info: https://containers.dev/features.
	"features": {
		"ghcr.io/devcontainers/features/rust:1": {},
		"ghcr.io/devcontainers/features/go:1": {},
		"ghcr.io/devcontainers/features/node:1": {
			"nodeGypDependencies": true,
			"installYarnUsingApt": false,
			"version": "lts",
			"pnpmVersion": "latest",
			"nvmVersion": "latest"
		},
		"ghcr.io/devcontainers/features/python:1": {},
		"ghcr.io/devcontainers/features/github-cli:1": {},
		"./zstd": {},
		"ghcr.io/devcontainers/features/sshd:1": {}
		// "ghcr.io/devcontainers-contrib/features/pdm:2": {},
	},

	"mounts": [
		{
			"source": "devcontainer-cargo-cache",
			"target": "/usr/local/cargo",
			"type": "volume"
		},
		{
			"source": "devcontainer-ssh",
			"target": "/root/.ssh",
			"type": "volume"
		},
		{
			"source": "devcontainer-pnpm-cache",
			"target": "/root/.pnpm-store",
			"type": "volume"
		},
		{
			"source": "oocana-rust-shell-history",
			"target": "/root/commandhistory",
			"type": "volume"
		},
		{
			"source": "ovmlayer-layers",
			"target": "/workspaces/ovmlayer-layers",
			"type": "volume"
		},
		{
			"source": "${localEnv:HOME}/.oh-my-zsh",
			"target": "/root/.oh-my-zsh",
			"type": "bind"
		},
		{
			"source": "${localEnv:HOME}/.zshrc",
			"target": "/root/.zshrc",
			"type": "bind"
		},
		{
			"source": "${localEnv:HOME}/oomol/oocana-python",
			"target": "/workspaces/oocana-python",
			"type": "bind"
		},
		{
			"source": "${localEnv:HOME}/oomol/oocana-node",
			"target": "/workspaces/oocana-node",
			"type": "bind"
		},
		{
			"source": "${localEnv:HOME}/.npmrc",
			"target": "/root/.npmrc",
			"type": "bind"
		},
		{
			"source": "${localEnv:HOME}/.config/gh/hosts.yml",
			"target": "/root/.config/gh/hosts.yml",
			"type": "bind"
		}
	],
	"remoteEnv": {
		"PATH": "${containerEnv:PATH}:/workspaces/oocana-node/packages/executor/dist:/workspaces/oocana-python/executor/bin"
	},
	"customizations": {
		"vscode": {
			"settings": {
				"terminal.integrated.defaultProfile.linux": "zsh",
				"terminal.integrated.profiles.linux": {
					"zsh": { "path": "/bin/zsh" }
				}
			}
		}
	},
	"runArgs": ["--privileged"],
	"remoteUser": "root",
	"onCreateCommand": "./.devcontainer/setup.sh"
}
